<!doctype html><html lang=ja dir=ltr><head><meta name=theme-color media="(prefers-color-scheme: light)" content="white"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  はじめに
  #

一昔前, GPD Pocketをはじめとした7, 8インチサイズの小型PC, UMPCが流行していたのを覚えているでしょうか. 特にドンキで販売されていたドンキPC, NANOTEシリーズは印象に残っている人も多いと思います.
結局, その流行は過ぎ去り, GPD WinシリーズやSteam Deckなどが今生き残っているUMPCの代表格となっています."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://ichigo.dev/posts/2024-10-28/"><meta property="og:site_name" content="Ichigo Notes"><meta property="og:title" content="MiniBook (J4125版) のファンを低温下で停止させる"><meta property="og:description" content="はじめに # 一昔前, GPD Pocketをはじめとした7, 8インチサイズの小型PC, UMPCが流行していたのを覚えているでしょうか. 特にドンキで販売されていたドンキPC, NANOTEシリーズは印象に残っている人も多いと思います. 結局, その流行は過ぎ去り, GPD WinシリーズやSteam Deckなどが今生き残っているUMPCの代表格となっています."><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-28T00:15:04+09:00"><meta property="article:modified_time" content="2024-10-28T00:19:08+09:00"><meta property="article:tag" content="UMPC"><meta property="article:tag" content="MiniBook"><meta property="article:tag" content="CHUWI"><meta property="article:tag" content="Embedded Controller"><meta property="article:tag" content="EC"><meta property="article:tag" content="Firmware"><title>MiniBook (J4125版) のファンを低温下で停止させる | Ichigo Notes</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=canonical href=https://ichigo.dev/posts/2024-10-28><link rel=stylesheet href=/book.min.4964903a822a7acb10dac6d1ab524833c97fb5f99b141976bcb8a47d539be9c0.css integrity="sha256-SWSQOoIqessQ2sbRq1JIM8l/tfmbFBl2vLikfVOb6cA=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/ja.search.min.8998750cbdd2329baaf2fb4241b67c3fbfe466bd06b55ba67ce58276b2c1faac.js integrity="sha256-iZh1DL3SMpuq8vtCQbZ8P7/kZr0GtVumfOWCdrLB+qw=" crossorigin=anonymous></script><link rel=stylesheet href=/css/all.min.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-2KMNJ1P766"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-2KMNJ1P766")</script><meta property="og:url" content="https://ichigo.dev/posts/2024-10-28/"><meta property="og:type" content="article"><meta property="og:site_name" content="Ichigo Notes"><meta property="og:title" content="MiniBook (J4125版) のファンを低温下で停止させる"><meta property="og:description" content='<h2 id="はじめに">
  はじめに
  <a class="anchor" href="#%e3%81%af%e3%81%98%e3%82%81%e3%81%ab">#</a>
</h2>
<p>一昔前, GPD Pocketをはじめとした7, 8インチサイズの小型PC, UMPCが流行していたのを覚えているでしょうか. 特にドンキで販売されていたドンキPC, NANOTEシリーズは印象に残っている人も多いと思います.
結局, その流行は過ぎ去り, GPD WinシリーズやSteam Deckなどが今生き残っているUMPCの代表格となっています.</p>'><meta property="og:image" content='https://ogp.ichigo.dev/?fake&title=MiniBook%20(J4125%E7%89%88)%20%E3%81%AE%E3%83%95%E3%82%A1%E3%83%B3%E3%82%92%E4%BD%8E%E6%B8%A9%E4%B8%8B%E3%81%A7%E5%81%9C%E6%AD%A2%E3%81%95%E3%81%9B%E3%82%8B'><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Ichigo Notes</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=検索 aria-label=検索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><strong><a href=/docs>Documents</a></strong></ul><ul><li><a href=/docs/for_myself/>個人用</a><ul><li><a href=/docs/for_myself/network/>おもちの構成</a></li></ul></li><li><a href=/docs/smilebasic/>SmileBASIC</a><ul><li><a href=/docs/smilebasic/sws/>Sprite Window System</a><ul><li><input type=checkbox id=section-85839ad307e43f5c0169d74ec5bc7f7d class=toggle>
<label for=section-85839ad307e43f5c0169d74ec5bc7f7d class="flex justify-between"><a href=/docs/smilebasic/sws/uikit/>UIKit v0.1</a></label><ul><li><a href=/docs/smilebasic/sws/uikit/views/>Views</a><ul><li><input type=checkbox id=section-fa5747b6a34368d5b7f449be56693333 class=toggle>
<label for=section-fa5747b6a34368d5b7f449be56693333 class="flex justify-between"><a role=button>Fundamental Views</a></label><ul><li><a href=/docs/smilebasic/sws/uikit/views/fundamental/view/>View</a></li><li><a href=/docs/smilebasic/sws/uikit/views/fundamental/wrapper/>Wrapper</a></li><li><a href=/docs/smilebasic/sws/uikit/views/fundamental/spacer/>Spacer</a></li></ul></li><li><input type=checkbox id=section-383e3b829097cbeaf7a9dd05fabf8ff6 class=toggle>
<label for=section-383e3b829097cbeaf7a9dd05fabf8ff6 class="flex justify-between"><a href=/docs/smilebasic/sws/uikit/views/layouts/>Layout Containers</a></label><ul><li><a href=/docs/smilebasic/sws/uikit/views/layouts/vstack/>VStack</a></li><li><a href=/docs/smilebasic/sws/uikit/views/layouts/hstack/>HStack</a></li><li><a href=/docs/smilebasic/sws/uikit/views/layouts/zstack/>ZStack</a></li></ul></li><li><input type=checkbox id=section-6fcf2486470206f0851bf261344ac03f class=toggle>
<label for=section-6fcf2486470206f0851bf261344ac03f class="flex justify-between"><a role=button>Navigation Containers</a></label><ul><li><a href=/docs/smilebasic/sws/uikit/views/navigations/navigationview/>NavigationView</a></li><li><a href=/docs/smilebasic/sws/uikit/views/navigations/navigationlink/>NavigationLink</a></li></ul></li><li><input type=checkbox id=section-b294f24df7de439569966c8d84349a39 class=toggle>
<label for=section-b294f24df7de439569966c8d84349a39 class="flex justify-between"><a role=button>Text and Inputs</a></label><ul><li><a href=/docs/smilebasic/sws/uikit/views/text_input/text/>Text</a></li></ul></li><li><input type=checkbox id=section-355e3d6574c1054dd65616edffecd248 class=toggle>
<label for=section-355e3d6574c1054dd65616edffecd248 class="flex justify-between"><a role=button>Controls</a></label><ul><li><a href=/docs/smilebasic/sws/uikit/views/controls/ubutton/>uButton</a></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><br><ul><li><strong>Contents</strong></li><li><a href=/posts>なんかやってるシリーズ</a></li><li><a href=/privacy>プライバシーポリシー</a></li></ul><br><ul><li><strong>Links</strong></li><li><a href=https://github.com/petitstrawberry>GitHub</a></li><li><a href=https://twitter.com/petitstb>Twitter</a></li><li><a href=https://mi.ichigo.dev/@ichigo>Misskey</a></li></ul><br><br><strong>Recent Tracks</strong>
<i class="fa-brands fa-lastfm"></i>
<a href=https://www.last.fm/user/PetitIchigo><ul id=lastfm-placeholder><li>Loading...</li></ul></a><script>var placeholder,generateLastfmContent=function(e){var t=document.createElement("ul");t.id="lastfm-placeholder",t.innerHTML=`
            <li class="mostRecentTitle" >
                ${e.track[0]["@attr"]?.nowplaying?'<i class="fa-solid fa-circle-play"></i>':""}
                ${e.track[0].name}
            </li>
        `;const n=Math.min(e.track.length,4);for(let s=1;s<n;s++)t.innerHTML+=`
                <li class="recentTitle">${e.track[s].name}</li>
            `;return t},fetchRecentTracks=async function(){const t="https://lastfm.api.ichigo.dev/recenttracks",e=await(await fetch(t,{method:"GET",mode:"cors",cache:"no-store"})).json();var n=document.getElementById("lastfm-placeholder");const s=generateLastfmContent(e);n.replaceWith(s),sessionStorage.setItem("lastfm",JSON.stringify(e))};const cache=sessionStorage.getItem("lastfm");if(cache){const e=JSON.parse(cache);placeholder=document.getElementById("lastfm-placeholder");const t=generateLastfmContent(e);placeholder.replaceWith(t)}fetchRecentTracks(),setInterval(fetchRecentTracks,3e4)</script><style>.lastfm ul{list-style:none;padding:0}.recentTitle{padding:0;font-size:xx-small;color:gray;margin-top:.25rem;margin-bottom:.25rem}.mostRecentTitle{font-size:small}</style></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#はじめに>はじめに</a></li><li><a href=#前提知識>前提知識</a><ul><li><a href=#chuwi-minibook>CHUWI MiniBook</a></li><li><a href=#embedded-controller-ec>Embedded Controller (EC)</a></li></ul></li><li><a href=#ecファームウェアの書き換え>ECファームウェアの書き換え</a><ul><li><a href=#準備>準備</a></li><li><a href=#手順>手順</a></li><li><a href=#1-ファームウェアのダンプ>1. ファームウェアのダンプ</a><ul><li><a href=#usbメモリの準備>USBメモリの準備</a></li><li><a href=#フラッシュツールを使ってダンプ>フラッシュツールを使ってダンプ</a></li></ul></li><li><a href=#2-ファームウェア解析書換え>2. ファームウェア解析・書換え</a><ul><li><a href=#便利ツール紹介>便利ツール紹介</a></li><li><a href=#書き換えるアドレスの特定>書き換えるアドレスの特定</a></li></ul></li><li><a href=#3-ファームウェアのフラッシュ>3. ファームウェアのフラッシュ</a><ul><li><a href=#usbメモリの準備-1>USBメモリの準備</a></li><li><a href=#フラッシュ>フラッシュ</a></li></ul></li><li><a href=#4-ファン停止確認>4. ファン停止確認</a></li></ul></li><li><a href=#おわりに>おわりに</a></li></ul></nav></aside></header><link rel=stylesheet href=/css/breadcrumb.css><ol class=breadcrumb><li><a href=/>Home</a></li><li><a href=/posts/>なんかやってるシリーズ</a></li><li class=active></li></ol><article class="markdown book-post"><h1>MiniBook (J4125版) のファンを低温下で停止させる</h1><h5>10月 28, 2024</h5><div><a href=/categories/pc/>PC</a>,
<a href=/categories/%E3%83%8F%E3%83%BC%E3%83%89%E3%82%A6%E3%82%A7%E3%82%A2/>ハードウェア</a>,
<a href=/categories/%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2/>ソフトウェア</a></div><div><a href=/tags/umpc/>UMPC</a>,
<a href=/tags/minibook/>MiniBook</a>,
<a href=/tags/chuwi/>CHUWI</a>,
<a href=/tags/embedded-controller/>Embedded Controller</a>,
<a href=/tags/ec/>EC</a>,
<a href=/tags/firmware/>Firmware</a>,
<a href=/tags/hack/>Hack</a></div><h2 id=はじめに>はじめに
<a class=anchor href=#%e3%81%af%e3%81%98%e3%82%81%e3%81%ab>#</a></h2><p>一昔前, GPD Pocketをはじめとした7, 8インチサイズの小型PC, UMPCが流行していたのを覚えているでしょうか. 特にドンキで販売されていたドンキPC, NANOTEシリーズは印象に残っている人も多いと思います.
結局, その流行は過ぎ去り, GPD WinシリーズやSteam Deckなどが今生き残っているUMPCの代表格となっています.</p><p>しかし, 流行りに乗り遅れながらもUMPCの魅力に惹かれてしまった私は, 今更ながらCHUWI MiniBookを購入しました. (実はNANOTEも以前購入していましたがあまりにも性能が悪すぎて使い物になりませんでした&mldr;)</p><p>搭載しているCPUはJ4125であり, N100には遠く及ばないとしてもNANOTEや初代GPD Pocketと比べて性能が高く, 割と(NeoVimでプログラム書いたり, marpによるスライド作成をする程度に)日常的に使えるPCとなっています.</p><blockquote class=twitter-tweet data-dnt=true><p lang=ja dir=ltr>というわけでワイのMiniBook (J4125)は最強UMPCに一歩近づきました！！<br><br>あとはLinuxでBluetoothが死ぬ問題を解決したい<br><br>指紋認証は流石にデータシートも何もないので厳しいかなぁ <a href=https://t.co/bIT9SzJSZE>https://t.co/bIT9SzJSZE</a> <a href=https://t.co/7buSkrF1BS>pic.twitter.com/7buSkrF1BS</a></p>&mdash; バトルプログラマー見習いいちご (@petitstb) <a href="https://twitter.com/petitstb/status/1822195358392258732?ref_src=twsrc%5Etfw">August 10, 2024</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>しかし&mldr;このMiniBookには一つだけ大きな問題があります. それは<strong>ファンの音</strong>です. CPU使用率が低く, CPU温度が低い状態でもファンが回り続けるため, 作業中にファンの音が気になることがあります. しかも, 高周波成分が多く, そこそこうるさく感じるレベルです.
このファンの回転はOSやBIOSから制御することができないため, 通常の方法ではファンを停止させることができません.</p><p>そこで本記事では, Embedded Controller (EC) のファームウェアを書き換えることでMiniBookのファンを低温下で停止させることに成功したので, その方法を紹介します.</p><blockquote class="book-hint danger"><p><strong>警告</strong></p><p>本記事では, PC内部のコントローラの<strong>ファームウェア書き換え</strong>について説明します. これは, <strong>メーカーの保証を無効にする行為</strong>であり, 場合によっては二度とPCが<strong>起動しなくなる可能性</strong>もあります.</p><p>自身で問題を解決できる方, この記事で実施している内容の意味を理解している方, 何が起きても諦めがつく方のみ実施してください.</p><p>また, 本記事に従って行った結果生じた損害については一切責任を負いません. <strong>自己責任</strong>でお願いします.</p></blockquote><h2 id=前提知識>前提知識
<a class=anchor href=#%e5%89%8d%e6%8f%90%e7%9f%a5%e8%ad%98>#</a></h2><h3 id=chuwi-minibook>CHUWI MiniBook
<a class=anchor href=#chuwi-minibook>#</a></h3><p>MiniBook (8インチ) 版にはいくつかのモデルが存在. それぞれ異なるCPUやハードウェア構成.</p><ul><li>m3-8100Y搭載モデル<ul><li>欧州版</li><li>日本版</li></ul></li><li>J4125搭載モデル<ul><li><strong>欧州版 今回対象のモデル</strong></li><li>日本版</li></ul></li></ul><p>今回は, 欧州版のJ4125搭載モデルを対象としています. モデルによってハードウェア構成が異なるため, (もちろん) ECのファームウェアも異なります. そのため, 他のモデルに対して本記事の内容を適用することはできません. ご注意を.</p><h3 id=embedded-controller-ec>Embedded Controller (EC)
<a class=anchor href=#embedded-controller-ec>#</a></h3><p>Embedded Controller (EC) とは, マザーボード上に搭載されているマイクロコントローラのことです. このECは, ハードウェアの制御や監視を行うためのものであり, ファンの制御もその一つです.</p><p>ものによっては, BIOS (UEFI) に対してインターフェースを提供しており, ファンの制御をBIOS, さらにはOSから行うこともできたりします. しかし, 一部のPCでは, 全ての制御がECによって行われており, BIOSやOSからの制御ができない場合があります. このMiniBookもその一つです.</p><h2 id=ecファームウェアの書き換え>ECファームウェアの書き換え
<a class=anchor href=#ec%e3%83%95%e3%82%a1%e3%83%bc%e3%83%a0%e3%82%a6%e3%82%a7%e3%82%a2%e3%81%ae%e6%9b%b8%e3%81%8d%e6%8f%9b%e3%81%88>#</a></h2><p>それならば, ECのファームウェアを書き換えてしまえばファンを停止させることができるはずです.</p><p>実は, MiniBook (m3-8100Y, 欧州版) では, ECのファームウェアを書き換えることでファンの停止を実現する手法<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>がフォーラム上で公開されていました.</p><div style=margin-top:10px><a href=https://forum.chuwi.com/t/minibook-ec-patch-fans-turn-off-now/4678 style="border-radius:8px;padding:12px;border:solid 2px var(--gray-200);display:flex;text-decoration:none;color:var(--body-font-color)" onmouseover='this.style.opacity="0.9"'><div style=flex-shrink:0><img src=/9f9ab4e18eccdbd937f27debfa41795b61649dab_16547253903495092.jpg alt width=100 height=100 style=object-fit:contain></div><div style=margin-left:10px><h2 style=margin:0;padding-bottom:13px;border:none;font-size:16px>Minibook EC patch (fans turn off now)</h2><p style=margin:0;font-size:13px;word-break:break-word;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;overflow:hidden>Hello everyone! I made a patch to the EC firmware that turns off the fans when temperatures are low. This took me almost a week! The patch is for European EC firmware! Note that the temperatures are very bad on my machine, probably because I disassembled it, so the fans keep turning on. But they turn off eventually so at least some battery is saved! Anyway, you can roll back it at any time if you’ll experience the same. I’M NOT RESPONSIBLE FOR YOUR BRICKED LAPTOPS! DO THIS AT YOUR OWN RISK! T...</p></div></a></div><p>これを参考にしつつ, MiniBook (J4125, 欧州版) に対しても同様の手法が適用できないか試してみました.</p><h3 id=準備>準備
<a class=anchor href=#%e6%ba%96%e5%82%99>#</a></h3><ul><li>やらかしても諦める心または, なんとしても復旧するという覚悟<ul><li>例: ROMライタ, SOIC8クリップなど</li></ul></li><li>CHUWI MiniBook (J4125, 欧州版)<ul><li>このモデル以外は対象外です&mldr;!!</li><li>他のモデルもまあ, 似た感じにできるので知識がある人は自分でリバースエンジニアリングしてバイナリの似た部分を探してみてください.</li></ul></li><li>USBメモリ</li><li>ファームウェア読み書き用ツール<ul><li><a href=https://forum.chuwi.com/t/minibook-official-version-chuwi-minibook-drivers-os-bios-ec-tutorial-download/3282>公式フォーラムの投稿</a>からEuope version EC 8100YのECファームウェア書込みツールをダウンロード</li></ul></li></ul><h3 id=手順>手順
<a class=anchor href=#%e6%89%8b%e9%a0%86>#</a></h3><p>作業は以下の手順で行います.</p><ol><li>ファームウェアのダンプ</li><li>ファームウェア解析・書換え</li><li>ファームウェアのフラッシュ</li><li>ファン停止確認</li></ol><h3 id=1-ファームウェアのダンプ>1. ファームウェアのダンプ
<a class=anchor href=#1-%e3%83%95%e3%82%a1%e3%83%bc%e3%83%a0%e3%82%a6%e3%82%a7%e3%82%a2%e3%81%ae%e3%83%80%e3%83%b3%e3%83%97>#</a></h3><p>まずは, ECのファームウェアを読み出します. これは, 今後の作業でのバックアップとしても重要です.
もし, 書換えに失敗しても, バックアップがあればROMライタで書き込めばなんとかなるかもしれません.</p><h4 id=usbメモリの準備>USBメモリの準備
<a class=anchor href=#usb%e3%83%a1%e3%83%a2%e3%83%aa%e3%81%ae%e6%ba%96%e5%82%99>#</a></h4><p>まず, 準備でダウンロードしたrarファイルを解凍します. その中には以下のファイルが含まれています.</p><ul><li>2019-10-29欧版EC/<ul><li>ec.bin<ul><li>ECのファームウェア</li><li>m3-8100Y版向けのため今回は不要</li></ul></li><li>efi/boot/<ul><li>Bootla32.efi</li><li>Bootx64.efi<ul><li>UEFIシェル</li></ul></li></ul></li><li>eFuitX64.efi<ul><li>フラッシュツール (今回のメイン)</li></ul></li><li>Startup.nsh<ul><li>今回は不要</li><li><strong>絶対に削除すること</strong></li></ul></li></ul></li></ul><p>フラッシュツールはEFIアプリケーションなので, これを起動するためにUSBメモリから起動できるようにします.</p><ol><li>USBメモリをFAT32でフォーマット</li><li>必要なファイルをUSBメモリにコピー<ul><li>不要なファイルは削除</li></ul></li></ol><p>最終的には以下のような構成になります.</p><ul><li>USBメモリ (root) /<ul><li>efi/boot/<ul><li>Bootla32.efi</li><li>Bootx64.efi</li></ul></li><li>eFuitX64.efi</li></ul></li></ul><h4 id=フラッシュツールを使ってダンプ>フラッシュツールを使ってダンプ
<a class=anchor href=#%e3%83%95%e3%83%a9%e3%83%83%e3%82%b7%e3%83%a5%e3%83%84%e3%83%bc%e3%83%ab%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6%e3%83%80%e3%83%b3%e3%83%97>#</a></h4><p>ファイルのコピーが終わったUSBメモリをMiniBookに挿入し, 電源を入れます.
するとUEFIシェルが起動します.</p><p><img src=figs/dump.png alt="UEFI Shell"></p><ol><li><code>fsX:</code> を実行し, USBメモリにアクセス<ul><li>環境によって異なるため, <code>fsX:</code> でアクセスできるドライブを探してください</li><li><code>ls</code> でファイル一覧を表示し, 正しいドライブか確認</li><li>画像の例では, <code>fs4</code> がUSBメモリであることがわかります</li></ul></li><li><code>eFuitX64.efi /d ec.bin</code> を実行してファームウェアをダンプ<ul><li><code>ec.bin</code> にファームウェアが保存される</li><li>この時, 異なるファイル名で何回かダンプしておくことをお勧めします</li></ul></li></ol><blockquote class="book-hint warning"><p><strong>注意</strong></p><p>状況によっては, SPIによる読み出しミスでファームウェアが正常にダンプできていないことがあります. そのため, 何度か異なるファイルにダンプしてハッシュ値を比較し, 同じファイルがダンプできていると確信が持てるまでダンプを繰り返すことをお勧めします.</p></blockquote><h3 id=2-ファームウェア解析書換え>2. ファームウェア解析・書換え
<a class=anchor href=#2-%e3%83%95%e3%82%a1%e3%83%bc%e3%83%a0%e3%82%a6%e3%82%a7%e3%82%a2%e8%a7%a3%e6%9e%90%e6%9b%b8%e6%8f%9b%e3%81%88>#</a></h3><p>ダンプしたファームウェアがUSBメモリに保存されているので, これを解析し, ファンの停止に関わる部分を探します.</p><p>先人の教え<sup id=fnref1:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>によると,</p><blockquote><p>For devs:
Our EC is IT8987 which contains the 8051 CPU inside. Official docs for this EC are not available, however you can find datasheets for similar chips, for example IT8570E or IT8511E. You can find the common part of EC firmware on GitHub 118, but you have to RE the OEM part. 8051 controller is 8-bit, but it’s very easy to learn how it works because of it’s simplicity :). Note that the firmware is divided into 4 “memory banks” (1 common at address 0, 3 other switchable, starting at 0x8000, bank size is 0x8000 bytes each), but the last one is not used. So 2+1 banks in total. The part that controls the fans is in 2nd bank. The patch is literally 1-byte.</p></blockquote><p>MiniBook (m3-8100Y) で使われているECはIT8987というものらしいです.
まあ, おそらく同じコントローラか似たものが使われていると予想してこの教えに従いましょう.(後に調べた結果同じでした)</p><p><del>具体的に教えのどこが参考になるんだよという細かい内容についてはノーコメントで</del></p><p>特に使われているCPUは, Intel 8051で命令がすべて1バイトの良い感じのCPUです.
先人の言うように勉強用にもちょうど良い感じです.</p><p>先人の手法ではこのECのファームウェアの, PWMによるファン制御の最小デューティサイクルを0に変更することで,
ファンが回転を始める温度をより高温に変更しているようです.</p><p>ここでも同じようにデューティサイクルを変更します.
まずはその値が設定されている場所を特定しなければなりません.</p><h4 id=便利ツール紹介>便利ツール紹介
<a class=anchor href=#%e4%be%bf%e5%88%a9%e3%83%84%e3%83%bc%e3%83%ab%e7%b4%b9%e4%bb%8b>#</a></h4><p>このオフセットを探すために便利だったツールがこちら.</p><h5 id=8051-disassembler>8051-disassembler
<a class=anchor href=#8051-disassembler>#</a></h5><p>いい感じに逆アセンブルしてくれる</p><div style=margin-top:10px><a href=https://github.com/anarcheuz/8051-disassembler style="border-radius:8px;padding:12px;border:solid 2px var(--gray-200);display:flex;text-decoration:none;color:var(--body-font-color)" onmouseover='this.style.opacity="0.9"'><div style=flex-shrink:0><img src=/8051-disassembler_3316180028653160060.png alt width=100 height=100 style=object-fit:contain></div><div style=margin-left:10px><h2 style=margin:0;padding-bottom:13px;border:none;font-size:16px>GitHub - anarcheuz/8051-disassembler</h2><p style=margin:0;font-size:13px;word-break:break-word;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;overflow:hidden>Contribute to anarcheuz/8051-disassembler development by creating an account on GitHub.</p></div></a></div><h5 id=8051-instruction-set>8051 Instruction Set
<a class=anchor href=#8051-instruction-set>#</a></h5><ul><li><a href=https://aeb.win.tue.nl/comp/8051/set8051.html>https://aeb.win.tue.nl/comp/8051/set8051.html</a></li><li>命令セットの表</li><li>機械語読むのに使った</li></ul><h4 id=書き換えるアドレスの特定>書き換えるアドレスの特定
<a class=anchor href=#%e6%9b%b8%e3%81%8d%e6%8f%9b%e3%81%88%e3%82%8b%e3%82%a2%e3%83%89%e3%83%ac%e3%82%b9%e3%81%ae%e7%89%b9%e5%ae%9a>#</a></h4><p>以上のツールなどを駆使した結果, 以下の表のオフセットにファンのデューティサイクルを設定する部分があることがわかりました. これを書き換えることでファンの停止を実現します.</p><table><thead><tr><th style=text-align:right>offset</th><th style=text-align:right>before</th><th style=text-align:right>after</th></tr></thead><tbody><tr><td style=text-align:right><code>0x1159d</code></td><td style=text-align:right><code>0x66</code></td><td style=text-align:right><code>0x00</code></td></tr></tbody></table><p>お好きなバイナリエディタや何らかの方法で, ダンプしたファームウェアを書き換えてください. この際, 元のファームウェアとは異なる名前で保存しておくことをお勧めします.</p><p>ここでは, 例として <code>ec_patched.bin</code> という名前で保存しておきます.</p><h3 id=3-ファームウェアのフラッシュ>3. ファームウェアのフラッシュ
<a class=anchor href=#3-%e3%83%95%e3%82%a1%e3%83%bc%e3%83%a0%e3%82%a6%e3%82%a7%e3%82%a2%e3%81%ae%e3%83%95%e3%83%a9%e3%83%83%e3%82%b7%e3%83%a5>#</a></h3><p>手順1のファームウェアのダンプで用いたフラッシュツールを使って今度は書き換えたファームウェアをフラッシュします.</p><h4 id=usbメモリの準備-1>USBメモリの準備
<a class=anchor href=#usb%e3%83%a1%e3%83%a2%e3%83%aa%e3%81%ae%e6%ba%96%e5%82%99-1>#</a></h4><p>USBメモリの構成は, 手順1と同じです. ただし, 今回は書き換えたファームウェアをUSBメモリにコピーしてください.</p><p>構成は以下のようになります.</p><ul><li>USBメモリ (root) /<ul><li>efi/boot/<ul><li>Bootla32.efi</li><li>Bootx64.efi</li></ul></li><li>eFuitX64.efi</li><li>ec_patched.bin<ul><li>書き換えたファームウェア</li></ul></li></ul></li></ul><h4 id=フラッシュ>フラッシュ
<a class=anchor href=#%e3%83%95%e3%83%a9%e3%83%83%e3%82%b7%e3%83%a5>#</a></h4><p>USBメモリをMiniBookに挿入し, 電源を入れます.
UEFIシェルが起動したら, フラッシュツールを使ってファームウェアを書き換えます.</p><p><img src=figs/flash.png alt="UEFI Shell"></p><ol><li><code>fsX:</code> を実行し, USBメモリにアクセス</li><li><code>eFuitX64.efi ec_patched.bin /faildelay</code> を実行してファームウェアを書き換え<ul><li>書き換えが完了すると, ファームウェアの書き換えが成功した旨のメッセージが表示されます</li></ul></li></ol><blockquote class="book-hint danger"><p><strong>警告</strong></p><p>ファームウェアの書き換えに失敗すると, PCが起動しなくなる可能性があります. そのため, 書き換え中に電源が切れるような事態は絶対に阻止してください. ここでやらかすと面倒なことになります.</p></blockquote><h3 id=4-ファン停止確認>4. ファン停止確認
<a class=anchor href=#4-%e3%83%95%e3%82%a1%e3%83%b3%e5%81%9c%e6%ad%a2%e7%a2%ba%e8%aa%8d>#</a></h3><p>ファームウェアの書き換えが完了したら, MiniBookを再起動してファンが停止しているか確認します.</p><p>高温時(大体55°C以上)になるまでファンが回転しないことを確認できれば成功です. おめでとうございます.
軽い作業を行なっている間は静かなMiniBookを楽しむことができるでしょう.</p><h2 id=おわりに>おわりに
<a class=anchor href=#%e3%81%8a%e3%82%8f%e3%82%8a%e3%81%ab>#</a></h2><p>本記事では, CHUWI MiniBook (J4125, 欧州版) のファンを低温下で停止させる方法を紹介しました.</p><p>ファンの音が気になる方は, ぜひ試してみてください. ただし, 何かあっても自己責任でお願いします.</p><p>やらかしても諦める心を持ち, 何が起きても諦めがつく覚悟で実施してください.</p><p><strong>決して, 他のモデルに対して本記事の内容を適用しないでください.</strong> 他のモデルに対しては, 別途調査が必要です. 以前フォーラムに公開されていたパッチ済みファームウェアは, m3-8100Y搭載モデル向けのものであるのに, 別の日本語モデルやJ4125搭載モデルのECのフラッシュに書き込んで文鎮化させている人を見かけて哀れな気持ちになりました. よく理解せずにやるとこうなるので, 本当に気をつけてください.</p><blockquote class="book-hint info">おそらく, 日本語版でも同様の手法が適用できると思われますが, その場合は別途調査が必要です.</blockquote><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://forum.chuwi.com/t/minibook-ec-patch-fans-turn-off-now/4678>https://forum.chuwi.com/t/minibook-ec-patch-fans-turn-off-now/4678</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/petitstrawberry/blog/commit/6c064dc289634bda1f6c59200d30e5138945cf5b title='最終更新者 PetitStrawberry | 10月 27, 2024' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt>
<span>10月 27, 2024</span></a></div><div><a class="flex align-center" href=https://github.com/petitstrawberry/blog/edit/master/content/posts/2024-10-28/index.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt>
<span>このページを編集する</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script><link rel=preload href=https://ichigo.dev/prevnextlink.min.255a1d4f15262284e117ef48fd5b77ef7426e538b869349b2a7ae1f98be44cff.css as=style><link rel=stylesheet href=https://ichigo.dev/prevnextlink.min.255a1d4f15262284e117ef48fd5b77ef7426e538b869349b2a7ae1f98be44cff.css><nav><div class=prevnextlink><div class=prevlink><i class="fa-regular fa-circle-left"></i>
<a href=/posts/2024-02-24/>コメント機能を追加しました</a></div></div></nav></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=petitstrawberry/petitstrawberry.github.io data-repo-id=R_kgDOHUlrWA data-category=Announcements data-category-id=DIC_kwDOHUlrWM4CdeSw data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ja crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#はじめに>はじめに</a></li><li><a href=#前提知識>前提知識</a><ul><li><a href=#chuwi-minibook>CHUWI MiniBook</a></li><li><a href=#embedded-controller-ec>Embedded Controller (EC)</a></li></ul></li><li><a href=#ecファームウェアの書き換え>ECファームウェアの書き換え</a><ul><li><a href=#準備>準備</a></li><li><a href=#手順>手順</a></li><li><a href=#1-ファームウェアのダンプ>1. ファームウェアのダンプ</a><ul><li><a href=#usbメモリの準備>USBメモリの準備</a></li><li><a href=#フラッシュツールを使ってダンプ>フラッシュツールを使ってダンプ</a></li></ul></li><li><a href=#2-ファームウェア解析書換え>2. ファームウェア解析・書換え</a><ul><li><a href=#便利ツール紹介>便利ツール紹介</a></li><li><a href=#書き換えるアドレスの特定>書き換えるアドレスの特定</a></li></ul></li><li><a href=#3-ファームウェアのフラッシュ>3. ファームウェアのフラッシュ</a><ul><li><a href=#usbメモリの準備-1>USBメモリの準備</a></li><li><a href=#フラッシュ>フラッシュ</a></li></ul></li><li><a href=#4-ファン停止確認>4. ファン停止確認</a></li></ul></li><li><a href=#おわりに>おわりに</a></li></ul></nav></div></aside></main></body></html>
