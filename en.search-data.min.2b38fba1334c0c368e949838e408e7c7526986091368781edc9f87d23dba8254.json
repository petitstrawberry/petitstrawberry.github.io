[{"id":0,"href":"/posts/2022-06-16/","title":"Raspberry PiとMediaPlayerを使ってOpenHomeレンダラを作る (前編)","section":"Posts","content":"音楽再生環境を何とかしたい！\nここ数日、家での音楽再生環境の再構築なんかやってました。結果として良い環境が仕上がったと思います。せっかくなのでその経緯をここに記します。\n今までの構成 # iMac MinimServer (音楽配信DLNAサーバ) Raspberry Pi 4 model B HiFiBerry DAC2 PRO (D/A) ここからライン出力してアンプに渡す moOde audio mpdをWeb UIから良い感じに使えるディストリビューション upmpdcli mpdをDLNA/OpenHomeレンダラとしても使えるようにする(moOdeからはオプションとして有効にできる) iPhone/MacBook/Android端末 Lumin AppやBubbleUPnPなどをOpenHomeコントローラとして使う というような構成でした。基本的にはmpdとしては(WebUIなども)使わず単にOpenHomeレンダラとして使っていました。\nなんか微妙な感じがするます # そもそも音楽再生用ディストリビューションって # 結局のところVolumioやmoOde audioといったものはmpdの各機能をWebUIから簡単に設定できるようにしているだけのものです。初心者でも難しいことをせずに、SDカードにイメージ焼いて、WebUIから設定すれば簡単に高機能なプレイヤーを構築できて良い感じです。\n他に機能面で言うと、mpdをベースに様々なソフトウェアを組み合わせることでupmpdcliでDLNA/OpenHomeレンダラとして使ったり、shairport-syncを使ってAirPlayレシーバにしたりできます。\nあくまでそのディストリが用意したものだけで完結させることを想定している感じです。 それ故にいくつか辛いことがあります。\n何が辛いのか # たとえば、\nWebUIの項目にないmpdの設定を変更しようと思って/etc/mpd.confを編集しても、起動時にmoOde側のテンプレートを基に動的生成された設定ファイルによって上書きされる。 編集したい場合は/etc/mpd.confではなくmoOde側が用意したテンプレートを編集する必要がある。 moOde側の設定ファイルのテンプレートなどを変更しても、moOdeの更新により上書きされる。 moOdeのシステムとの連携の都合があるので、moOdeのソフトウェアアップデート機能ではなくapt-get upgradeして各ソフトウェアを更新するなどしてソフトウェアを変更したような場合、起動しなくなることがある。 同様の理由で一部のソフトウェアを自分で改変してビルドして使うようにすることも困難。 といった辛いポイントがある。辛い。\nこのようにmoOde側が用意した項目以外に変更を加えるような使い方には向いていないことがわかります。\nさらに、VolumioやmoOdeはDLNA/OpenHomeレンダラやAirPlayレシーバとして使うよりも、「Raspberry Pi自体をmpdによって音楽プレイヤーにしよう」という考え方で作られたディストリビューションであるので、mpdはバックエンドにあればよくて、いい感じの選曲用WebUIとか必要なく、「OpenHomeレンダラとして使いたいだけなんだ！」という僕みたいな人には向いてません。\nそしてOpenHome/DLNAレンダラ化する際にはupmpdcliにお世話になるので、ここに不満点があると辛いことになります。もちろんmpd自体に不満点があっても辛いことになります。\n辛いことになった\nここからはVolumioやmoOdeの問題というより、僕にどのような事情があってmoOdeに手を入れたくなり、辛いことになったかという個人的な問題の話題になります。読み飛ばしてもらっても問題ありません。 個人的に辛かったこと mpdをOpenHomeレンダラ(DMR)として動作させるため、upmpdcliはLumin Appなどのコントローラ(DMC)とmpdの間を中継して、再生する曲のURLや再生制御をmpdに指示したり、再生位置や音量などの情報をDMCに渡したりします。 そうして受けた再生指示で、URLから曲を再生します。\nここで辛いことになった。\nこのように渡されたURLから音楽を再生すると、mpdではアーティスト名が奇妙なことになります。\n再生中の曲情報を表示してみると\n$ mpc -f \u0026#34;%artist%\u0026#34; 北宇治高校吹奏楽部, 松田彬人(composer), kensuke ushio [paused] #1/1 0:01/6:25 (0%) volume: 50% repeat: off random: off single: off consume: on のように、artist, composer, album_artistがまとめてartistとして扱われてしまいました。単に音楽を再生するだけであれば大して問題にもなりません。 しかし、僕はmpdで再生している曲の情報を取得してlast.fmにscrobbleするmpdasというソフトウェアを使おうと考えていました。つまりこのままmpdasを使うとアーティスト名に余計な情報を含めたままlast.fmにscrobbleしてしまうのです。(mpdasはmpd向けのソフトウェア)\nここで、これをなんとか解決しようと考えました。まず、Lumin Appから再生中の曲のアーティスト名がどのように表示されているのかを確認しました。ここでは問題はありませんでした。つまり、OpenHomeのレイヤーでは問題はないということです。upmpdcliとmpdのどちらかかその両方に問題があるということになります。そして、その原因を調べて修正しようと考えました。\nしかし、ここで力尽きました。先に述べたようにmoOdeの環境で各ソフトウェアを改変するのは辛いです。\n結局、OpenHomeでしか使わないのにmpdのレイヤーで色々と試行錯誤するのは微妙な感じがした(正直upmpdcliがよくわからんかった)ので、もういっそのことmoOdeを使うことをやめ、OpenHomeレンダラとして使うことに重きを置いた環境を構築しようと考えました。\n良さげなMediaPlayerの発見 # そして色々と漁っていたところMediaPlayerというソフトウェアを発見しました。これは\u0026quot;MediaPlayer - Java Based Open Home UPnP Media Renderer\u0026quot;ということでどうやらこれが求めていたものに近そうです。ディストリビューションではないので、Raspberry Pi OS(旧raspbian)などの上に追加でインストールしていきます。\nこのMediaPlayerは音楽の再生部にmpdかmplayerのどちらかを選んでOpenHomeレンダラとして扱えるようにするようです。さらにプラグインにも対応しており、OpenHomeのレイヤーで情報を取得することができそうです。(この中にはlast.fmのscrobblerもありました。)\nせっかくmplayerというmpd以外の選択肢もあるのですが、mpdの方が細かい設定が出来そう(今までの知見が活かせる)ので結局mpdをバックエンドに使うことになりました。つまり、mpd+upmpdcliのupmpdcliをMediaPlayerに置き換えただけということになります。(mpd使うならあんまり変わってないじゃないか！とは思いますが)\nただ、moOdeやVolumioというように単独の音楽プレイヤー化を目指したものではなく、余計なもの(OpenHomeレンダラに必要ないもの)が含まれていないので扱いやすそうです。これまでダラダラと書いてきましたが、結局mpdのフロントエンドをOpenHomeレンダラとして使うことに特化したものに置き換えるというだけの話になります。\nという訳で、MediaPlayerを採用することにしました。ここからの環境構築のお話は後編に続きます。\n"},{"id":1,"href":"/posts/2022-05-27/","title":"Cydiaリポジトリの引越し","section":"Posts","content":"新しくドメインを取得し, GitHub Pagesの使い方が変わったため, それに合わせて以前のhttps://petitstrawberry.github.io/cydiaのCydiaリポジトリが使用できない状態になっていました.\nまだ引越し作業が済んでいない状態(説明ページが404エラーなど)ではありますが, 復旧の要望があったのでひとまず以前の状態のまま再公開することになりました.\nただし, 以前のURLは使えずhttps://cydia.ichigo.devに変更になっています.\n気が向き次第引越し作業再開します. 気が向くかどうかはわかりません.\n"},{"id":2,"href":"/posts/2022-05-14/","title":"なんかやってるシリーズ始まります","section":"Posts","content":" 初めに # こんにちは、いちごです。最近良い感じのドメイン(ichigo.dev)を取得し、使い道を考えていました。その結果、折角なので何か記事を書くブログ的なWebサイトに使おうということで\u0026quot;Ichigo Notes なんかやってるシリーズ\u0026quot;始まります。\nなんかやってるシリーズとは # なんか(SwitchからPCへの転送とか)やってる#プチコン4 #petitcom pic.twitter.com/BrGq8Ti3zK\n\u0026mdash; ぷちぃいちぃご (@petitstb) March 18, 2022 SE100をBluetoothでコントロールするControlAK、ひとまず完成した。\nレスポンスはまだ改善の余地がありそう pic.twitter.com/TFlCsGroao\n\u0026mdash; ぷちぃいちぃご (@petitstb) January 18, 2021 こんな感じに今まで色々とやってましたが、それらの技術的な解説とかそういう感じのやつはツイートではなかなか厳しいところもある気がするような気がしなくなくもないので、そういう奴らをまとめるシリーズです。\n主にiOS, Android, macOS, SmileBASIC系の話になるような気がする。その他にも今後色々（日常的な何かも）気が向いたら書くかもしれないし、更新しないかもしれない。軽いノリなので正確性に欠けるかもしれないけれど、そんな感じでよろしくお願いします。\n(おまけ)このサイトについて # Markdownで記事書くといい感じに爆速でビルドしてくれるらしいのでHugoで作ってみました。privateリポジトリにPushするとGitHub Actionsでいい感じにGitHub Pagesのリポジトリにデプロイしてくれるので快適です。\n"}]